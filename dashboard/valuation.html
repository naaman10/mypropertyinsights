<div class="row pt-3" id="dashboardValuation">

</div>
<div class="row pt-3" id="dashboardValChart">
  <div class="col-12">
    <div class="dashCard shadow-sm">
      <div class="dashCardHeader">Price History</div>
      <div class="dashCardBody">
        <canvas id="lineChart"></canvas>
      </div>
    </div>
  </div>
</div>

<script>
  var urlString = window.location.href;
  var url = new URL(urlString);
  var valuationId = url.searchParams.get("id");
  var externalDataRef = firebase.database().ref('valuation/' + valuationId + '/externalData');
  externalDataRef.on('value', function (snapshot) {
    var valFlatPrice = snapshot.val().flat.average;
    var valTerracedPrice = snapshot.val().terraced.average;
    var valDetachedPrice = snapshot.val().detached.average;
    if (valTerracedPrice !== undefined) {
      $("#dashboardValuation").append('<div class="col-12 col-sm-6 col-md-6 col-lg-3 mb-3"><div class="dashCard shadow-sm"><div class="dashCardHeader">Average Flat Price</div><div class="dashCardBody"><h2>£' + valTerracedPrice.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") + '</h2></div></div></div>');
    }
    if (valFlatPrice !== undefined) {
      $("#dashboardValuation").append('<div class="col-12 col-sm-6 col-md-6 col-lg-3 mb-3"><div class="dashCard shadow-sm"><div class="dashCardHeader">Average Terrace Price</div><div class="dashCardBody"><h2>£' + valFlatPrice.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") + '</h2></div></div></div>');
    }
    if (valDetachedPrice !== undefined) {
      $("#dashboardValuation").append('<div class="col-12 col-sm-6 col-md-6 col-lg-3 mb-3"><div class="dashCard shadow-sm"><div class="dashCardHeader">Average Detached Price</div><div class="dashCardBody"><h2>£' + valDetachedPrice.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") + '</h2></div></div></div>');
    }
  });
  //line
  var ctxL = document.getElementById("lineChart").getContext('2d');
  var myLineChart = new Chart(ctxL, {
    type: 'line',
    data: {
      labels: ["AUG 13", "AUG 14", "AUG 15", "AUG 16", "AUG 17", "AUG 18"],
      datasets: [{
          label: "Annual Growth",
          data: [209008, 218326, 231329, 248234, 252874, 255305],
          backgroundColor: [
            'rgba(44,161,61,.2)',
          ],
          borderColor: [
            '#2CA13D',
          ],
          borderWidth: 2
        }
      ]
    },
    options: {
      responsive: true
    }
  });

  </script>
<!-- .toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") -->
